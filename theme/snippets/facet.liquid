{% liquid
  assign opened_accordions = opened_accordions | default: false

  assign total_active_values = total_active_values | plus: filter.active_values.size

  assign presentation = filter.presentation | default: 'text'

  comment
  if presentation == 'image'
    assign show_more_number = 12
    assign visual_layout_class = 'facets-layout facets-layout-grid facets-layout-grid--' | append: presentation
  else
    assign show_more_number = 10
    assign visual_layout_class = 'facets-layout facets-layout-list facets-layout-list--' | append: presentation
  endif
  endcomment
%}

<details class="accordion__section facets__accordion-section{% if opened_accordions %} is-active{% endif %}" id="Filters-accordion-section-{{- index -}}"{% if opened_accordions %} open{% endif %}>
  <summary class="facets__accordion-btn h4 js-btn" id="Filters-accordion-button-{{- index -}}">
    {{- filter.label | escape -}}

    <div class="facets__accordion-icon">
      {%- render 'icon', icon_name: 'theme-chevron', class: 'icon' -%}
    </div>
  </summary>

  <div class="accordion__body facets__accordion-body slim-scrollbar" id="Filters-accordion-dropdown-{{- index -}}" {% if opened_accordions %} style="height: auto;"{% endif %}>
    <div id="Filter-{{ filter.param_name | escape }}-{{ section.id }}" class="js-filter" data-index="{{- index -}}">

      {%- case filter.type -%}
        {%- when 'list' or 'boolean' -%}
          <ul class="facets__list list-unstyled" role="list">

            {%- for value in filter.values -%}
              <li class="facets__item{% if value.active %} facets__item--checked{% endif %}">
                {%- liquid
                  assign checkbox_additional_classes = ''
                  capture checkbox_attr
                    if value.active
                      echo 'checked'
                    endif

                    if value.count == 0 and value.active == false
                      echo 'disabled'
                    endif
                  endcapture

                  assign id = 'Filter-' | append: filter.param_name | escape | append: '-' | append: forloop.index | strip
                  assign checkbox_attr = checkbox_attr | strip

                  if value.count == 0 and value.active == false
                    assign checkbox_additional_classes = checkbox_additional_classes | append: 'checkbox--disabled'
                  endif
                -%}


                <div class="checkbox facet-checkbox {{ checkbox_additional_classes }}" tabindex="0">
                  {%- if presentation == 'swatch' and value.swatch != blank -%}
                    {% render 'product-option', type: 'checkbox', id: id, name: value.param_name, value: value.value, form_id: product_form_id, swatch_value: value.swatch, checked: value.active, visually_hidden: true, where: 'facet' %}
                    <label for="{{- id -}}" class="checkbox__label" aria-hidden="true">
                      {{- value.label | escape -}}
                    </label>
                  {%- else -%}
                    <input type="checkbox" name="{{- value.param_name -}}" value="{{- value.value -}}" id="{{- id -}}"
                      class="product-option__input"
                      {{ checkbox_attr }}
                    >
                    {%- if presentation == 'image' -%}
                      {%- if value.image -%}
                        <label for="{{- id -}}" class="varian-option__label media product-option__image">
                          {% render 'image', image: value.image, width: 200 %}
                        </label>
                      {%- endif -%}
                    {%- else -%}
                      <label for="{{- id -}}">
                        {{- value.label | escape -}}
                      </label>
                    {%- endif -%}
                  {%- endif -%}

                  {%- assign id = nil -%}
                  {%- assign checkbox_attr = nil -%}
                </div>
              </li>
            {%- endfor -%}
          </ul>
        {%- when 'price_range' -%}
          {%- liquid
            comment
              IMPORTANT:
              - `filter.range_max` and `filter.min_value.value` / `filter.max_value.value` are amounts in cents.
              - For slider + input[type=number] we use major units (e.g. 19.99) via divided_by: 100.0 (locale-agnostic).
            endcomment

            assign range_max_major = filter.range_max | divided_by: 100.0 | round: 0

            assign current_min_major = 0
            if filter.min_value.value
              assign current_min_major = filter.min_value.value | divided_by: 100.0 | round: 0
            endif

            assign current_max_major = range_max_major
            if filter.max_value.value
              assign current_max_major = filter.max_value.value | divided_by: 100.0 | round: 0
            endif
          -%}

          <price-range class="facets__price facets__price--slider" data-currency-symbol="{{ cart.currency.symbol }}">
            <div class="facets__price-slider" data-price-slider>
              <div class="facets__price-slider-track" aria-hidden="true">
                <span class="facets__price-slider-range" data-price-slider-range></span>
              </div>

              <input
                type="range"
                class="facets__price-slider-input facets__price-slider-input--min"
                min="0"
                max="{{ range_max_major }}"
                step="1"
                value="{{ current_min_major }}"
                data-price-slider-min
              >

              <input
                type="range"
                class="facets__price-slider-input facets__price-slider-input--max"
                min="0"
                max="{{ range_max_major }}"
                step="1"
                value="{{ current_max_major }}"
                data-price-slider-max
              >

              <div class="facets__price-slider-labels">
                <span data-price-slider-min-label></span>
                <span data-price-slider-max-label></span>
              </div>
            </div>

            {% comment %} Hidden inputs that Shopify reads for the actual filter submission (kept in DOM) {% endcomment %}
            <div class="facets__price-row">
              <span>{{- cart.currency.symbol -}}</span>
              {%-
                liquid
                assign label = 'collection.filters_from' | t
                assign filter_label = filter.label | escape
                assign id = 'Filter-' | append: filter_label | append: '-GTE'
                assign input_placeholder = '0'
                assign max = range_max_major
                assign value = current_min_major

                render 'text-input', type: 'number', class: 'facets__price-field', name: filter.min_value.param_name, id: id, value: value, label: label, placeholder: input_placeholder, min: 0, max: max, hide_label: false, attr: 'data-price-input="min"'
              -%}
            </div>

            <div class="facets__price-row">
              <span>{{- cart.currency.symbol -}}</span>
              {%- liquid
                assign label = 'collection.filters_to' | t
                assign filter_label = filter.label | escape
                assign id = 'Filter-' | append: filter_label | append: '-LTE'
                assign input_placeholder = range_max_major
                assign max = range_max_major
                assign value = current_max_major

                render 'text-input', type: 'number', class: 'facets__price-field', name: filter.max_value.param_name, id: id, value: value, label: label, placeholder: input_placeholder, min: 0, max: max, hide_label: false, attr: 'data-price-input="max"'
              -%}
            </div>
          </price-range>
      {%- endcase -%}
    </div>
  </div>
</details>
